import{T as S}from"./index-F4zUvqIc.js";import{u as L,b as F,a as P,d as B,c as N}from"./menu-BIDTTZs1.js";import{d as V,L as U,k as c,_ as T,y as w,o as C,w as o,b as t,r,i as v,E,c as G,a as _,e as D,t as $,J as z,K as A,M as J}from"./index-BrpxYkzO.js";import{s as M,a as O,b as j}from"./Search-hOF0ZlMh.js";const I=V({components:{Layer:U},props:{layer:{type:Object,default:()=>({show:!1,title:"",showButton:!0})}},setup(e,a){const s=c(null),f=c(null);let u=c(""),g=c([]),i=c({id:"",code:"",parentCode:"",name:"",path:"",icon:"",sort:""});const n={code:[{required:!0,message:"请输入编码",trigger:"blur"}],name:[{required:!0,message:"请输入姓名",trigger:"blur"}],email:[{required:!0,message:"请选择",trigger:"blur"}],enable:[{required:!0,message:"请选择",trigger:"blur"}],phone:[{required:!0,message:"请选择",trigger:"blur"}]};d();function d(){e.layer.row&&(i.value=JSON.parse(JSON.stringify(e.layer.row))),P().then(h=>{g.value=h.data})}return{form:i,rules:n,layerDom:f,ruleForm:s,selectedParentCode:u,menuList:g}},methods:{submit(){this.ruleForm&&this.ruleForm.validate(e=>{if(e){let a=this.form;this.layer.row?this.updateForm(a):this.addForm(a)}else return!1})},addForm(e){F(e).then(a=>{this.$message({type:"success",message:"新增成功"}),this.$emit("getTableData",!0),this.layerDom&&this.layerDom.close()})},updateForm(e){L(e.id,e).then(a=>{this.$message({type:"success",message:"编辑成功"}),this.$emit("getTableData",!1),this.layerDom&&this.layerDom.close()})}}});function K(e,a,s,f,u,g){const i=r("el-input"),n=r("el-form-item"),d=r("el-input-number"),h=r("el-form"),b=r("Layer",!0);return C(),w(b,{layer:e.layer,onConfirm:e.submit,ref:"layerDom"},{default:o(()=>[t(h,{model:e.form,rules:e.rules,ref:"ruleForm","label-width":"120px",style:{"margin-right":"30px"}},{default:o(()=>[t(n,{label:"菜单编码：",prop:"code"},{default:o(()=>[t(i,{modelValue:e.form.code,"onUpdate:modelValue":a[0]||(a[0]=l=>e.form.code=l),disabled:e.form.id!=="",placeholder:"请输入菜单编码"},null,8,["modelValue","disabled"])]),_:1}),t(n,{label:"菜单名称：",prop:"name"},{default:o(()=>[t(i,{modelValue:e.form.name,"onUpdate:modelValue":a[1]||(a[1]=l=>e.form.name=l),placeholder:"请输入菜单名称"},null,8,["modelValue"])]),_:1}),t(n,{label:"菜单路径："},{default:o(()=>[t(i,{modelValue:e.form.path,"onUpdate:modelValue":a[2]||(a[2]=l=>e.form.path=l),placeholder:"请输入菜单路径"},null,8,["modelValue"])]),_:1}),t(n,{label:"排序：",prop:"sort"},{default:o(()=>[t(d,{modelValue:e.form.sort,"onUpdate:modelValue":a[3]||(a[3]=l=>e.form.sort=l),min:1,max:99999,onChange:e.handleChange},null,8,["modelValue","onChange"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["layer","onConfirm"])}const H=T(I,[["render",K]]),Q=V({name:"crudTable",components:{Table:S,Layer:H},setup(){const e=v({}),a=v({show:!1,title:"新增",showButton:!0}),s=v({currentPage:1,pageSize:10,totalCount:0}),f=c(!0),u=c([]),g=c([]),i=l=>{g.value=l},n=l=>{f.value=!0,l&&(s.currentPage=1);let y={currentPage:s.currentPage,pageSize:s.pageSize,sorter:"desc-sort",...e};B(y).then(p=>{u.value=p.data.list,s.totalCount=Number(p.data.totalCount)}).catch(p=>{u.value=[],s.currentPage=1,s.totalCount=0}).finally(()=>{f.value=!1})},d=l=>{let y={ids:l.map(p=>p.id).join(",")};N(y.ids).then(p=>{E({type:"success",message:"删除成功"}),n(u.value.length===1)})},h=()=>{a.title="新增数据",a.show=!0,delete a.row},b=l=>{a.title="编辑数据",a.row=l,a.show=!0};return n(!0),{Plus:j,Search:O,Delete:M,query:e,tableData:u,chooseData:g,loading:f,page:s,layer:a,handleSelectionChange:i,handleAdd:h,handleEdit:b,handleDel:d,getTableData:n}}}),R={class:"layout-container"},W={class:"layout-container-form flex space-between"},X={class:"layout-container-form-search"},Y={class:"layout-container-form flex space-between"},Z={class:"layout-container-form-handle"},x={class:"layout-container-table"};function ee(e,a,s,f,u,g){const i=r("el-input"),n=r("el-form-item"),d=r("el-button"),h=r("el-form"),b=r("el-popconfirm"),l=r("el-table-column"),y=r("Table"),p=r("Layer"),k=J("loading");return C(),G("div",R,[_("div",W,[_("div",X,[t(h,{inline:!0,model:e.params,class:"demo-form-inline"},{default:o(()=>[t(n,{label:"菜单编码："},{default:o(()=>[t(i,{modelValue:e.query.qp_code_like,"onUpdate:modelValue":a[0]||(a[0]=m=>e.query.qp_code_like=m),placeholder:"请输入菜单编码",clearable:""},null,8,["modelValue"])]),_:1}),t(n,{label:"菜单名称："},{default:o(()=>[t(i,{modelValue:e.query.qp_name_like,"onUpdate:modelValue":a[1]||(a[1]=m=>e.query.qp_name_like=m),placeholder:"请输入菜单名称",clearable:""},null,8,["modelValue"])]),_:1}),t(n,null,{default:o(()=>[t(d,{type:"primary",onClick:a[2]||(a[2]=m=>e.getTableData())},{default:o(()=>[...a[5]||(a[5]=[D("查询",-1)])]),_:1})]),_:1})]),_:1},8,["model"])])]),_("div",Y,[_("div",Z,[t(d,{type:"primary",icon:e.Plus,onClick:e.handleAdd},{default:o(()=>[D($(e.$t("message.common.add")),1)]),_:1},8,["icon","onClick"]),t(b,{title:e.$t("message.common.delTip"),onConfirm:a[3]||(a[3]=m=>e.handleDel(e.chooseData))},{reference:o(()=>[t(d,{type:"danger",icon:e.Delete,disabled:e.chooseData.length===0},{default:o(()=>[D($(e.$t("message.common.delBat")),1)]),_:1},8,["icon","disabled"])]),_:1},8,["title"])])]),_("div",x,[z((C(),w(y,{ref:"table",page:e.page,"onUpdate:page":a[4]||(a[4]=m=>e.page=m),showIndex:!0,showSelection:!0,data:e.tableData,onGetTableData:e.getTableData,onSelectionChange:e.handleSelectionChange},{default:o(()=>[t(l,{prop:"code",label:"菜单编码",align:"center"}),t(l,{prop:"name",label:"菜单名称",align:"center"}),t(l,{prop:"path",label:"路径",align:"center"}),t(l,{prop:"sort",label:"排序",align:"center"}),t(l,{label:e.$t("message.common.handle"),align:"center",fixed:"right",width:"200"},{default:o(m=>[t(d,{onClick:q=>e.handleEdit(m.row)},{default:o(()=>[D($(e.$t("message.common.update")),1)]),_:1},8,["onClick"]),t(b,{title:e.$t("message.common.delTip"),onConfirm:q=>e.handleDel([m.row])},{reference:o(()=>[t(d,{type:"danger"},{default:o(()=>[D($(e.$t("message.common.del")),1)]),_:1})]),_:1},8,["title","onConfirm"])]),_:1},8,["label"])]),_:1},8,["page","data","onGetTableData","onSelectionChange"])),[[k,e.loading]]),e.layer.show?(C(),w(p,{key:0,layer:e.layer,onGetTableData:e.getTableData},null,8,["layer","onGetTableData"])):A("",!0)])])}const ne=T(Q,[["render",ee]]);export{ne as default};

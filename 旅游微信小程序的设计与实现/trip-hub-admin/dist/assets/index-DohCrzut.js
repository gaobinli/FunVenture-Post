import{T as L}from"./index-F4zUvqIc.js";import{d as F,a as N}from"./food-C1a8AI0D.js";import{u as B,a as P}from"./role-bFoOqc15.js";import{d as V,L as U,k as y,_ as k,y as T,o as w,w as l,b as a,r as o,i as C,N as E,E as G,u as z,c as J,a as D,e as $,t as v,J as O,K as j,M as A}from"./index-BrpxYkzO.js";import{s as M,a as R,b as I}from"./Search-hOF0ZlMh.js";const K=V({components:{Layer:U},props:{layer:{type:Object,default:()=>({show:!1,title:"",showButton:!0})}},setup(e,t){const n=y(null),g=y(null);let u=y({id:"",url:"",name:"",price:"",content:""});const h={url:[{required:!0,message:"请输入封面",trigger:"blur"}],name:[{required:!0,message:"请输入名称",trigger:"blur"}],price:[{required:!0,message:"请输入价格",trigger:"blur"}],content:[{required:!0,message:"请输入详情内容",trigger:"blur"}]};s();function s(){e.layer.row&&(u.value=JSON.parse(JSON.stringify(e.layer.row)))}return{form:u,rules:h,layerDom:g,ruleForm:n}},methods:{submit(){this.ruleForm&&this.ruleForm.validate(e=>{if(e){let t=this.form;this.layer.row?this.updateForm(t):this.addForm(t)}else return!1})},addForm(e){P(e).then(t=>{this.$message({type:"success",message:"新增成功"}),this.$emit("getTableData",!0),this.layerDom&&this.layerDom.close()})},updateForm(e){B(e.id,e).then(t=>{this.$message({type:"success",message:"编辑成功"}),this.$emit("getTableData",!1),this.layerDom&&this.layerDom.close()})}}});function H(e,t,n,g,u,h){const s=o("el-input"),p=o("el-form-item"),i=o("el-form"),b=o("Layer",!0);return w(),T(b,{layer:e.layer,onConfirm:e.submit,ref:"layerDom"},{default:l(()=>[a(i,{model:e.form,rules:e.rules,ref:"ruleForm","label-width":"120px",style:{"margin-right":"30px"}},{default:l(()=>[a(p,{label:"封面：",prop:"url"},{default:l(()=>[a(s,{modelValue:e.form.url,"onUpdate:modelValue":t[0]||(t[0]=r=>e.form.url=r),placeholder:"请输入封面"},null,8,["modelValue"])]),_:1}),a(p,{label:"名称：",prop:"name"},{default:l(()=>[a(s,{modelValue:e.form.name,"onUpdate:modelValue":t[1]||(t[1]=r=>e.form.name=r),placeholder:"请输入名称"},null,8,["modelValue"])]),_:1}),a(p,{label:"价格：",prop:"price"},{default:l(()=>[a(s,{modelValue:e.form.price,"onUpdate:modelValue":t[2]||(t[2]=r=>e.form.price=r),placeholder:"请输入价格"},null,8,["modelValue"])]),_:1}),a(p,{label:"详情内容：",prop:"content"},{default:l(()=>[a(s,{modelValue:e.form.content,"onUpdate:modelValue":t[3]||(t[3]=r=>e.form.content=r),placeholder:"请输入详情内容"},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["layer","onConfirm"])}const Q=k(K,[["render",H]]),W=V({name:"crudTable",components:{Table:L,Layer:Q},setup(){const e=C({}),t=C({show:!1,title:"新增",showButton:!0}),n=C({currentPage:1,pageSize:10,totalCount:0}),g=y(!0),u=y([]),h=y([]),s=z(),p=c=>{h.value=c},i=c=>{g.value=!0,c&&(n.currentPage=1);let _={currentPage:n.currentPage,pageSize:n.pageSize,...e};F(_).then(f=>{u.value=f.data.list,n.totalCount=Number(f.data.totalCount)}).catch(f=>{u.value=[],n.currentPage=1,n.totalCount=0}).finally(()=>{g.value=!1})},b=c=>{let _={ids:c.map(f=>f.id).join(",")};N(_.ids).then(f=>{G({type:"success",message:"删除成功"}),i(u.value.length===1)})},r=()=>{s.push({path:"/food/add"})},d=c=>{s.push({path:"/food/update",query:{id:c.id}})};return i(!0),{Plus:I,Search:R,Delete:M,query:e,tableData:u,chooseData:h,loading:g,page:n,layer:t,handleSelectionChange:p,handleAdd:r,handleEdit:d,handleDel:b,getTableData:i,handleTime:E}}}),X={class:"layout-container"},Y={class:"layout-container-form flex space-between"},Z={class:"layout-container-form-search"},x={class:"layout-container-form flex space-between"},ee={class:"layout-container-form-handle"},ae={class:"layout-container-table"};function te(e,t,n,g,u,h){const s=o("el-input"),p=o("el-form-item"),i=o("el-button"),b=o("el-form"),r=o("el-popconfirm"),d=o("el-table-column"),c=o("el-image"),_=o("Table"),f=o("Layer"),S=A("loading");return w(),J("div",X,[D("div",Y,[D("div",Z,[a(b,{inline:!0,model:e.params,class:"demo-form-inline"},{default:l(()=>[a(p,{label:"名称："},{default:l(()=>[a(s,{modelValue:e.query.qp_name_like,"onUpdate:modelValue":t[0]||(t[0]=m=>e.query.qp_name_like=m),placeholder:"请输入名称",clearable:""},null,8,["modelValue"])]),_:1}),a(p,null,{default:l(()=>[a(i,{type:"primary",onClick:t[1]||(t[1]=m=>e.getTableData())},{default:l(()=>[...t[4]||(t[4]=[$("查询",-1)])]),_:1})]),_:1})]),_:1},8,["model"])])]),D("div",x,[D("div",ee,[a(i,{type:"primary",icon:e.Plus,onClick:e.handleAdd},{default:l(()=>[$(v(e.$t("message.common.add")),1)]),_:1},8,["icon","onClick"]),a(r,{title:e.$t("message.common.delTip"),onConfirm:t[2]||(t[2]=m=>e.handleDel(e.chooseData))},{reference:l(()=>[a(i,{type:"danger",icon:e.Delete,disabled:e.chooseData.length===0},{default:l(()=>[$(v(e.$t("message.common.delBat")),1)]),_:1},8,["icon","disabled"])]),_:1},8,["title"])])]),D("div",ae,[O((w(),T(_,{ref:"table",page:e.page,"onUpdate:page":t[3]||(t[3]=m=>e.page=m),showIndex:!0,showSelection:!0,data:e.tableData,onGetTableData:e.getTableData,onSelectionChange:e.handleSelectionChange},{default:l(()=>[a(d,{prop:"name",label:"名称",align:"center"}),a(d,{prop:"url",label:"美食封面",align:"center"},{default:l(m=>[a(c,{style:{width:"100px",height:"100px"},src:m.row.url,"preview-src-list":[m.row.url],"initial-index":0,fit:"url","append-to-body":!0},null,8,["src","preview-src-list"])]),_:1}),a(d,{prop:"price",label:"价格",align:"center"}),a(d,{prop:"inventory",label:"库存",align:"center"}),a(d,{prop:"shortRecommend",label:"简要介绍",align:"center"}),a(d,{prop:"address",label:"地址",align:"center"}),a(d,{prop:"createTime",label:"创建时间",align:"center",formatter:e.handleTime},null,8,["formatter"]),a(d,{label:e.$t("message.common.handle"),align:"center",fixed:"right",width:"250"},{default:l(m=>[a(i,{onClick:q=>e.handleEdit(m.row)},{default:l(()=>[$(v(e.$t("message.common.update")),1)]),_:1},8,["onClick"]),a(r,{title:e.$t("message.common.delTip"),onConfirm:q=>e.handleDel([m.row])},{reference:l(()=>[a(i,{type:"danger"},{default:l(()=>[$(v(e.$t("message.common.del")),1)]),_:1})]),_:1},8,["title","onConfirm"])]),_:1},8,["label"])]),_:1},8,["page","data","onGetTableData","onSelectionChange"])),[[S,e.loading]]),e.layer.show?(w(),T(f,{key:0,layer:e.layer,onGetTableData:e.getTableData},null,8,["layer","onGetTableData"])):j("",!0)])])}const ie=k(W,[["render",te]]);export{ie as default};

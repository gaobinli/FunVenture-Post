import{T as L}from"./index-F4zUvqIc.js";import{d as k,L as F,C as E,D as P,k as y,_ as S,y as $,o as w,w as t,b as a,r,c as U,x as B,F as N,i as T,G,H as O,E as z,I as J,a as v,e as _,t as D,J as j,K as A,M as I}from"./index-BrpxYkzO.js";import{g as M,r as H}from"./role-bFoOqc15.js";import{s as K,a as R,b as Q}from"./Search-hOF0ZlMh.js";const W=k({components:{Layer:F},props:{layer:{type:Object,default:()=>({show:!1,title:"",showButton:!0})}},setup(e,l){const u=y(null),c=y(null);let m=y({id:"",code:"",name:"",email:"",password:"",enable:!1,phone:"",roleCodes:[]}),b=y([]);const p={code:[{required:!0,message:"请输入账号",trigger:"blur"}],name:[{required:!0,message:"请输入姓名",trigger:"blur"}],enable:[{required:!0,message:"请选择是否启用",trigger:"blur"}],phone:[{required:!0,message:"请输入手机号",trigger:"blur"},{pattern:/^(13[0-9]|14[579]|15[0-3,5-9]|16[6]|17[0135678]|18[0-9]|19[89])\d{8}$/,message:"手机号格式不正确",trigger:"blur"}]};n();function n(){e.layer.row&&(m.value=JSON.parse(JSON.stringify(e.layer.row)),M(m.value.id).then(i=>{i.data.forEach(h=>{m.value.roleCodes.push(h.code)})})),H().then(i=>{b.value=i.data})}return{form:m,rules:p,layerDom:c,ruleForm:u,roleOptions:b}},methods:{submit(){this.ruleForm&&this.ruleForm.validate(e=>{if(e){let l=this.form;this.layer.row?this.updateForm(l):this.addForm(l)}else return!1})},addForm(e){e.password=e.code,P(e).then(l=>{this.$message({type:"success",message:"新增成功"}),this.$emit("getTableData",!0),this.layerDom&&this.layerDom.close()})},updateForm(e){E(e.id,e).then(l=>{this.$message({type:"success",message:"编辑成功"}),this.$emit("getTableData",!1),this.layerDom&&this.layerDom.close()})}}});function X(e,l,u,c,m,b){const p=r("el-input"),n=r("el-form-item"),i=r("el-option"),h=r("el-select"),V=r("el-switch"),f=r("el-form"),s=r("Layer",!0);return w(),$(s,{layer:e.layer,onConfirm:e.submit,ref:"layerDom"},{default:t(()=>[a(f,{model:e.form,rules:e.rules,ref:"ruleForm","label-width":"120px",style:{"margin-right":"30px"}},{default:t(()=>[a(n,{label:"账号：",prop:"code"},{default:t(()=>[a(p,{modelValue:e.form.code,"onUpdate:modelValue":l[0]||(l[0]=o=>e.form.code=o),disabled:e.form.id!=="",placeholder:"请输入账号"},null,8,["modelValue","disabled"])]),_:1}),a(n,{label:"密码：",prop:"password"},{default:t(()=>[a(p,{modelValue:e.form.password,"onUpdate:modelValue":l[1]||(l[1]=o=>e.form.password=o),placeholder:"请输入密码"},null,8,["modelValue"])]),_:1}),a(n,{label:"姓名：",prop:"name"},{default:t(()=>[a(p,{modelValue:e.form.name,"onUpdate:modelValue":l[2]||(l[2]=o=>e.form.name=o),placeholder:"请输入名称"},null,8,["modelValue"])]),_:1}),a(n,{label:"手机号：",prop:"phone"},{default:t(()=>[a(p,{modelValue:e.form.phone,"onUpdate:modelValue":l[3]||(l[3]=o=>e.form.phone=o),placeholder:"请输入名称"},null,8,["modelValue"])]),_:1}),a(n,{label:"邮箱："},{default:t(()=>[a(p,{modelValue:e.form.email,"onUpdate:modelValue":l[4]||(l[4]=o=>e.form.email=o),placeholder:"请输入名称"},null,8,["modelValue"])]),_:1}),a(n,{label:"角色："},{default:t(()=>[a(h,{modelValue:e.form.roleCodes,"onUpdate:modelValue":l[5]||(l[5]=o=>e.form.roleCodes=o),multiple:"",placeholder:"选择角色，非必选"},{default:t(()=>[(w(!0),U(N,null,B(e.roleOptions,o=>(w(),$(i,{key:o.code,label:o.name,value:o.code},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),a(n,{label:"是否启用："},{default:t(()=>[a(V,{modelValue:e.form.enable,"onUpdate:modelValue":l[6]||(l[6]=o=>e.form.enable=o)},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["layer","onConfirm"])}const Y=S(W,[["render",X]]),Z=k({name:"crudTable",components:{Table:L,Layer:Y},setup(){const e=T({}),l=T({show:!1,title:"新增",showButton:!0}),u=T({currentPage:1,pageSize:10,totalCount:0}),c=y(!0),m=y([]),b=y([]),p=s=>{b.value=s},n=s=>{c.value=!0,s&&(u.currentPage=1);let o={currentPage:u.currentPage,pageSize:u.pageSize,...e};G(o).then(g=>{m.value=g.data.list,u.totalCount=Number(g.data.totalCount)}).catch(g=>{m.value=[],u.currentPage=1,u.totalCount=0}).finally(()=>{c.value=!1})},i=s=>{let o={ids:s.map(g=>g.id).join(",")};O(o.ids).then(g=>{z({type:"success",message:"删除成功"}),n(m.value.length===1)})},h=()=>{l.title="新增数据",l.show=!0,delete l.row},V=s=>{s.password=null,l.title="编辑数据",l.row=s,l.show=!0},f=s=>{J(s.id,s).then(o=>{}).catch(o=>{m.value=[],u.currentPage=1,u.totalCount=0}).finally(()=>{c.value=!1})};return n(!0),{Plus:Q,Search:R,Delete:K,query:e,tableData:m,chooseData:b,loading:c,page:u,layer:l,handleSelectionChange:p,handleAdd:h,handleEdit:V,handleDel:i,getTableData:n,updateEnableStatus:f}}}),x={class:"layout-container"},ee={class:"layout-container-form flex space-between"},le={class:"layout-container-form-search"},ae={class:"layout-container-form flex space-between"},oe={class:"layout-container-form-handle"},te={class:"layout-container-table"};function ne(e,l,u,c,m,b){const p=r("el-input"),n=r("el-form-item"),i=r("el-button"),h=r("el-form"),V=r("el-popconfirm"),f=r("el-table-column"),s=r("el-switch"),o=r("Table"),g=r("Layer"),q=I("loading");return w(),U("div",x,[v("div",ee,[v("div",le,[a(h,{inline:!0,model:e.params,class:"demo-form-inline"},{default:t(()=>[a(n,{label:"账号："},{default:t(()=>[a(p,{modelValue:e.query.qp_code_like,"onUpdate:modelValue":l[0]||(l[0]=d=>e.query.qp_code_like=d),placeholder:"请输入用户账号",clearable:""},null,8,["modelValue"])]),_:1}),a(n,{label:"用户名称："},{default:t(()=>[a(p,{modelValue:e.query.qp_name_like,"onUpdate:modelValue":l[1]||(l[1]=d=>e.query.qp_name_like=d),placeholder:"请输入用户名称",clearable:""},null,8,["modelValue"])]),_:1}),a(n,null,{default:t(()=>[a(i,{type:"primary",onClick:l[2]||(l[2]=d=>e.getTableData())},{default:t(()=>[...l[5]||(l[5]=[_("查询",-1)])]),_:1})]),_:1})]),_:1},8,["model"])])]),v("div",ae,[v("div",oe,[a(i,{type:"primary",icon:e.Plus,onClick:e.handleAdd},{default:t(()=>[_(D(e.$t("message.common.add")),1)]),_:1},8,["icon","onClick"]),a(V,{title:e.$t("message.common.delTip"),onConfirm:l[3]||(l[3]=d=>e.handleDel(e.chooseData))},{reference:t(()=>[a(i,{type:"danger",icon:e.Delete,disabled:e.chooseData.length===0},{default:t(()=>[_(D(e.$t("message.common.delBat")),1)]),_:1},8,["icon","disabled"])]),_:1},8,["title"])])]),v("div",te,[j((w(),$(o,{ref:"table",page:e.page,"onUpdate:page":l[4]||(l[4]=d=>e.page=d),showIndex:!0,showSelection:!0,data:e.tableData,onGetTableData:e.getTableData,onSelectionChange:e.handleSelectionChange},{default:t(()=>[a(f,{prop:"code",label:"账号",align:"center"}),a(f,{prop:"name",label:"名字",align:"center"}),a(f,{prop:"phone",label:"手机号",align:"center"}),a(f,{prop:"email",label:"邮箱",align:"center"}),a(f,{prop:"",label:"启用状态"},{default:t(d=>[a(s,{modelValue:d.row.enable,"onUpdate:modelValue":C=>d.row.enable=C,onChange:C=>e.updateEnableStatus(d.row)},null,8,["modelValue","onUpdate:modelValue","onChange"])]),_:1}),a(f,{prop:"createUser",label:"创建人",align:"center"}),a(f,{label:e.$t("message.common.handle"),align:"center",fixed:"right",width:"200"},{default:t(d=>[a(i,{onClick:C=>e.handleEdit(d.row)},{default:t(()=>[_(D(e.$t("message.common.update")),1)]),_:1},8,["onClick"]),a(V,{title:e.$t("message.common.delTip"),onConfirm:C=>e.handleDel([d.row])},{reference:t(()=>[a(i,{type:"danger"},{default:t(()=>[_(D(e.$t("message.common.del")),1)]),_:1})]),_:1},8,["title","onConfirm"])]),_:1},8,["label"])]),_:1},8,["page","data","onGetTableData","onSelectionChange"])),[[q,e.loading]]),e.layer.show?(w(),$(g,{key:0,layer:e.layer,onGetTableData:e.getTableData},null,8,["layer","onGetTableData"])):A("",!0)])])}const ie=S(Z,[["render",ne]]);export{ie as default};

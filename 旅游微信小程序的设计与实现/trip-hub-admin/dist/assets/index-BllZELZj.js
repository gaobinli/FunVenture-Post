import{T as L}from"./index-F4zUvqIc.js";import{u as P,a as F,d as E,b as B,p as G}from"./user-BrHDgzIY.js";import{d as U,L as O,k as w,_ as q,y as S,o as D,w as o,b as a,r as t,e as y,c as N,a as _,i as T,Q as z,N as J,E as j,t as C,J as A,K as M,M as I}from"./index-BrpxYkzO.js";import{u as K}from"./index-BlucuoM0.js";import{s as Q,a as R,b as H}from"./Search-hOF0ZlMh.js";const W="http://127.0.0.1:9000",X=U({components:{Layer:O,UploadFilled:K},props:{layer:{type:Object,default:()=>({show:!1,title:"",showButton:!0})}},setup(e,l){const i=w(null),g=w(null);let m=w({id:"",nickName:"",phone:"",password:"",sex:"",avatar:""}),v=w([]);const c={nickName:[{required:!0,message:"请输入昵称",trigger:"blur"}],phone:[{required:!0,message:"请输入手机号",trigger:"blur"},{pattern:/^(13[0-9]|14[579]|15[0-3,5-9]|16[6]|17[0135678]|18[0-9]|19[89])\d{8}$/,message:"手机号格式不正确",trigger:"blur"}]};r();function r(){e.layer.row&&(m.value=JSON.parse(JSON.stringify(e.layer.row)))}let d=W+"/upload";return{form:m,rules:c,layerDom:g,ruleForm:i,menuOptions:v,handleUploadSuccess:(b,u)=>{m.value.avatar=b.data},uploadPath:d}},methods:{submit(){this.ruleForm&&this.ruleForm.validate(e=>{if(e){let l=this.form;this.layer.row?this.updateForm(l):this.addForm(l)}else return!1})},addForm(e){F(e).then(l=>{this.$message({type:"success",message:"新增成功"}),this.$emit("getTableData",!0),this.layerDom&&this.layerDom.close()})},updateForm(e){P(e.id,e).then(l=>{this.$message({type:"success",message:"编辑成功"}),this.$emit("getTableData",!1),this.layerDom&&this.layerDom.close()})}}}),Y=["src"],Z={key:1};function x(e,l,i,g,m,v){const c=t("el-input"),r=t("el-form-item"),d=t("el-radio"),$=t("el-radio-group"),b=t("upload-filled"),u=t("el-icon"),s=t("el-upload"),h=t("el-switch"),f=t("el-form"),k=t("Layer",!0);return D(),S(k,{layer:e.layer,onConfirm:e.submit,ref:"layerDom"},{default:o(()=>[a(f,{model:e.form,rules:e.rules,ref:"ruleForm","label-width":"120px",style:{"margin-right":"30px"}},{default:o(()=>[a(r,{label:"昵称：",prop:"nickName"},{default:o(()=>[a(c,{modelValue:e.form.nickName,"onUpdate:modelValue":l[0]||(l[0]=p=>e.form.nickName=p),placeholder:"请输入昵称"},null,8,["modelValue"])]),_:1}),a(r,{label:"手机号：",prop:"phone"},{default:o(()=>[a(c,{modelValue:e.form.phone,"onUpdate:modelValue":l[1]||(l[1]=p=>e.form.phone=p),placeholder:"请输入手机号"},null,8,["modelValue"])]),_:1}),a(r,{label:"密码：",prop:"subtitle"},{default:o(()=>[a(c,{modelValue:e.form.password,"onUpdate:modelValue":l[2]||(l[2]=p=>e.form.password=p),placeholder:"请输入密码，默认与账号一样"},null,8,["modelValue"])]),_:1}),a(r,{label:"性别："},{default:o(()=>[a($,{modelValue:e.form.sex,"onUpdate:modelValue":l[3]||(l[3]=p=>e.form.sex=p)},{default:o(()=>[a(d,{label:1},{default:o(()=>[...l[5]||(l[5]=[y("男",-1)])]),_:1}),a(d,{label:2},{default:o(()=>[...l[6]||(l[6]=[y("女",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1}),a(r,{label:"头像：",prop:"url"},{default:o(()=>[a(s,{class:"upload-demo",drag:"",action:e.uploadPath,multiple:"false","on-success":e.handleUploadSuccess,"show-file-list":!1},{default:o(()=>[e.form.avatar?(D(),N("img",{key:0,src:e.form.avatar,class:"avatar",style:{widht:"148px",height:"148px"}},null,8,Y)):(D(),N("span",Z,[a(u,{class:"el-icon--upload"},{default:o(()=>[a(b)]),_:1}),l[7]||(l[7]=_("div",{class:"el-upload__text"},[y(" 拖动图片或 "),_("em",null,"点击上传")],-1))]))]),_:1},8,["action","on-success"])]),_:1}),a(r,{label:"是否启用："},{default:o(()=>[a(h,{modelValue:e.form.enable,"onUpdate:modelValue":l[4]||(l[4]=p=>e.form.enable=p)},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["layer","onConfirm"])}const ee=q(X,[["render",x]]),le=U({name:"crudTable",components:{Table:L,Layer:ee},setup(){const e=T({}),l=T({show:!1,title:"新增",showButton:!0}),i=T({currentPage:1,pageSize:10,totalCount:0}),g=w(!0),m=w([]),v=w([]),c=s=>{v.value=s},r=s=>{g.value=!0,s&&(i.currentPage=1);let h={currentPage:i.currentPage,pageSize:i.pageSize,...e};E(h).then(f=>{m.value=f.data.list,i.totalCount=Number(f.data.totalCount)}).catch(f=>{m.value=[],i.currentPage=1,i.totalCount=0}).finally(()=>{g.value=!1})},d=s=>{let h={ids:s.map(f=>f.id).join(",")};B(h.ids).then(f=>{j({type:"success",message:"删除成功"}),r(m.value.length===1)})},$=()=>{l.title="新增数据",l.show=!0,delete l.row},b=s=>{l.title="编辑数据",l.row=s,l.show=!0};return r(!0),{Plus:H,Search:R,Delete:Q,query:e,tableData:m,chooseData:v,loading:g,page:i,layer:l,handleSelectionChange:c,handleAdd:$,handleEdit:b,handleDel:d,getTableData:r,handleTime:J,handleSex:z,updateEnableStatus:s=>{G(s.id,s).then(h=>{}).catch(h=>{m.value=[],i.currentPage=1,i.totalCount=0}).finally(()=>{g.value=!1})}}}}),ae={class:"layout-container"},oe={class:"layout-container-form flex space-between"},te={class:"layout-container-form-search"},ne={class:"layout-container-form flex space-between"},re={class:"layout-container-form-handle"},se={class:"layout-container-table"};function ie(e,l,i,g,m,v){const c=t("el-input"),r=t("el-form-item"),d=t("el-button"),$=t("el-form"),b=t("el-popconfirm"),u=t("el-table-column"),s=t("el-image"),h=t("el-switch"),f=t("Table"),k=t("Layer"),p=I("loading");return D(),N("div",ae,[_("div",oe,[_("div",te,[a($,{inline:!0,model:e.params,class:"demo-form-inline"},{default:o(()=>[a(r,{label:"昵称："},{default:o(()=>[a(c,{modelValue:e.query.qp_nickName_like,"onUpdate:modelValue":l[0]||(l[0]=n=>e.query.qp_nickName_like=n),placeholder:"请输入昵称",clearable:""},null,8,["modelValue"])]),_:1}),a(r,{label:"手机号："},{default:o(()=>[a(c,{modelValue:e.query.qp_phone_like,"onUpdate:modelValue":l[1]||(l[1]=n=>e.query.qp_phone_like=n),placeholder:"请输入手机号",clearable:""},null,8,["modelValue"])]),_:1}),a(r,null,{default:o(()=>[a(d,{type:"primary",onClick:l[2]||(l[2]=n=>e.getTableData())},{default:o(()=>[...l[5]||(l[5]=[y("查询",-1)])]),_:1})]),_:1})]),_:1},8,["model"])])]),_("div",ne,[_("div",re,[a(d,{type:"primary",icon:e.Plus,onClick:e.handleAdd},{default:o(()=>[y(C(e.$t("message.common.add")),1)]),_:1},8,["icon","onClick"]),a(b,{title:e.$t("message.common.delTip"),onConfirm:l[3]||(l[3]=n=>e.handleDel(e.chooseData))},{reference:o(()=>[a(d,{type:"danger",icon:e.Delete,disabled:e.chooseData.length===0},{default:o(()=>[y(C(e.$t("message.common.delBat")),1)]),_:1},8,["icon","disabled"])]),_:1},8,["title"])])]),_("div",se,[A((D(),S(f,{ref:"table",page:e.page,"onUpdate:page":l[4]||(l[4]=n=>e.page=n),showIndex:!0,showSelection:!0,data:e.tableData,onGetTableData:e.getTableData,onSelectionChange:e.handleSelectionChange},{default:o(()=>[a(u,{prop:"nickName",label:"昵称",align:"center"}),a(u,{prop:"balance",label:"余额",align:"center"}),a(u,{prop:"phone",label:"手机号",align:"center"}),a(u,{prop:"sex",label:"性别",align:"center",formatter:e.handleSex},null,8,["formatter"]),a(u,{prop:"url",label:"头像",align:"center"},{default:o(n=>[a(s,{style:{width:"100px",height:"100px"},src:n.row.avatar,"preview-src-list":[n.row.avatar],"initial-index":0,fit:"url","append-to-body":!0},null,8,["src","preview-src-list"])]),_:1}),a(u,{prop:"enable",label:"启用状态"},{default:o(n=>[a(h,{modelValue:n.row.enable,"onUpdate:modelValue":V=>n.row.enable=V,onChange:V=>e.updateEnableStatus(n.row)},null,8,["modelValue","onUpdate:modelValue","onChange"])]),_:1}),a(u,{prop:"createTime",label:"创建时间",align:"center",formatter:e.handleTime},null,8,["formatter"]),a(u,{label:e.$t("message.common.handle"),align:"center",fixed:"right",width:"200"},{default:o(n=>[a(d,{onClick:V=>e.handleEdit(n.row)},{default:o(()=>[y(C(e.$t("message.common.update")),1)]),_:1},8,["onClick"]),a(b,{title:e.$t("message.common.delTip"),onConfirm:V=>e.handleDel([n.row])},{reference:o(()=>[a(d,{type:"danger"},{default:o(()=>[y(C(e.$t("message.common.del")),1)]),_:1})]),_:1},8,["title","onConfirm"])]),_:1},8,["label"])]),_:1},8,["page","data","onGetTableData","onSelectionChange"])),[[p,e.loading]]),e.layer.show?(D(),S(k,{key:0,layer:e.layer,onGetTableData:e.getTableData},null,8,["layer","onGetTableData"])):M("",!0)])])}const fe=q(le,[["render",ie]]);export{fe as default};

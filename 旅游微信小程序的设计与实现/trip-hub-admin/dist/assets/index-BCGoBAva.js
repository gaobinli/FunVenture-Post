import{T as O}from"./index-F4zUvqIc.js";import{u as A,a as G,d as z,b as J,p as B}from"./order-Frxt1xhu.js";import{c as j}from"./user-BrHDgzIY.js";import{d as P,L as R,k as T,_ as E,y as D,o as v,w as o,b as t,r as u,i as I,N as K,E as w,T as U,c as F,a as C,F as Y,x as H,e as f,t as _,J as Q,K as L,M as W}from"./index-BrpxYkzO.js";import{s as X,a as Z,b as x}from"./Search-hOF0ZlMh.js";const ee=P({components:{Layer:R},props:{layer:{type:Object,default:()=>({show:!1,title:"",showButton:!0})}},setup(e,a){const i=T(null),d=T(null);let g=T({id:"",type:"",userId:"",status:"",relationId:""});const y={id:[{required:!0,message:"请输入主键",trigger:"blur"}],type:[{required:!0,message:"请输入订单类型，1 景点、2 美食、3 酒店",trigger:"blur"}],userId:[{required:!0,message:"请输入用户",trigger:"blur"}],status:[{required:!0,message:"请输入状态：1 待发货、2 待收货、3 已收货、4 退货中、5 已退货",trigger:"blur"}],relationId:[{required:!0,message:"请输入关联id",trigger:"blur"}]};n();function n(){e.layer.row&&(g.value=JSON.parse(JSON.stringify(e.layer.row)))}return{form:g,rules:y,layerDom:d,ruleForm:i}},methods:{submit(){this.ruleForm&&this.ruleForm.validate(e=>{if(e){let a=this.form;this.layer.row?this.updateForm(a):this.addForm(a)}else return!1})},addForm(e){G(e).then(a=>{this.$message({type:"success",message:"新增成功"}),this.$emit("getTableData",!0),this.layerDom&&this.layerDom.close()})},updateForm(e){A(e.id,e).then(a=>{this.$message({type:"success",message:"编辑成功"}),this.$emit("getTableData",!1),this.layerDom&&this.layerDom.close()})}}});function te(e,a,i,d,g,y){const n=u("el-input"),m=u("el-form-item"),h=u("el-form"),s=u("Layer",!0);return v(),D(s,{layer:e.layer,onConfirm:e.submit,ref:"layerDom"},{default:o(()=>[t(h,{model:e.form,rules:e.rules,ref:"ruleForm","label-width":"120px",style:{"margin-right":"30px"}},{default:o(()=>[t(m,{label:"订单类型，1 景点、2 美食、3 酒店：",prop:"type"},{default:o(()=>[t(n,{modelValue:e.form.type,"onUpdate:modelValue":a[0]||(a[0]=p=>e.form.type=p),placeholder:"请输入订单类型，1 景点、2 美食、3 酒店"},null,8,["modelValue"])]),_:1}),t(m,{label:"用户：",prop:"userId"},{default:o(()=>[t(n,{modelValue:e.form.userId,"onUpdate:modelValue":a[1]||(a[1]=p=>e.form.userId=p),placeholder:"请输入用户"},null,8,["modelValue"])]),_:1}),t(m,{label:"状态：1 待发货、2 待收货、3 已收货、4 退货中、5 已退货：",prop:"status"},{default:o(()=>[t(n,{modelValue:e.form.status,"onUpdate:modelValue":a[2]||(a[2]=p=>e.form.status=p),placeholder:"请输入状态：1 待发货、2 待收货、3 已收货、4 退货中、5 已退货"},null,8,["modelValue"])]),_:1}),t(m,{label:"关联id：",prop:"relationId"},{default:o(()=>[t(n,{modelValue:e.form.relationId,"onUpdate:modelValue":a[3]||(a[3]=p=>e.form.relationId=p),placeholder:"请输入关联id"},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["layer","onConfirm"])}const ae=E(ee,[["render",te]]),le={1:"景点",2:"美食",3:"酒店"},oe={1:"待发货",2:"待收货",3:"已收货",4:"退货中",5:"已退货"},re=P({name:"crudTable",components:{Table:O,Layer:ae},setup(){const e=I({}),a=T([]),i=I({show:!1,title:"新增",showButton:!0}),d=I({currentPage:1,pageSize:10,totalCount:0}),g=T(!0),y=T([]),n=T([]),m=T(new Map),h=r=>{n.value=r},s=r=>{g.value=!0,r&&(d.currentPage=1);let c={currentPage:d.currentPage,pageSize:d.pageSize,...e};z(c).then($=>{y.value=$.data.list,d.totalCount=Number($.data.totalCount)}).catch($=>{y.value=[],d.currentPage=1,d.totalCount=0}).finally(()=>{g.value=!1})},p=r=>{let c={ids:r.map($=>$.id).join(",")};J(c.ids).then($=>{w({type:"success",message:"删除成功"}),s(y.value.length===1)})},V=()=>{i.title="新增数据",i.show=!0,delete i.row},b=r=>{i.title="编辑数据",i.row=r,i.show=!0},q=r=>le[r]||"未知",S=r=>oe[r]||"未知",N=r=>m.value.get(r)||"未知用户",l=()=>{j().then(r=>{r.data&&r.data.length>0&&(a.value=r.data,r.data.forEach(c=>{m.value.set(c.id,c.nickName)}))}).catch(r=>{console.error("获取用户列表失败",r)})},k=r=>{U.confirm("确认要发货吗？","发货确认",{confirmButtonText:"确认",cancelButtonText:"取消",type:"warning"}).then(()=>{B(r.id,{status:2}).then(c=>{w({type:"success",message:"发货成功"}),s(!1)}).catch(c=>{w({type:"error",message:"发货失败"})})}).catch(()=>{w({type:"info",message:"已取消发货"})})},M=r=>{U.confirm("确认要完成退货吗？","退货确认",{confirmButtonText:"确认",cancelButtonText:"取消",type:"warning"}).then(()=>{B(r.id,{status:5}).then(c=>{w({type:"success",message:"退货成功"}),s(!1)}).catch(c=>{w({type:"error",message:"退货失败"})})}).catch(()=>{w({type:"info",message:"已取消退货"})})};return l(),s(!0),{Plus:x,Search:Z,Delete:X,query:e,tableData:y,chooseData:n,loading:g,page:d,layer:i,userList:a,handleSelectionChange:h,handleAdd:V,handleEdit:b,handleDel:p,getTableData:s,handleTime:K,getTypeText:q,getStatusText:S,getUserNickName:N,handleShipOrder:k,handleReturnOrder:M}}}),ne={class:"layout-container"},se={class:"layout-container-form flex space-between"},ue={class:"layout-container-form-search"},ie={class:"layout-container-form flex space-between"},de={class:"layout-container-form-handle"},me={class:"layout-container-table"};function pe(e,a,i,d,g,y){const n=u("el-option"),m=u("el-select"),h=u("el-form-item"),s=u("el-button"),p=u("el-form"),V=u("el-popconfirm"),b=u("el-table-column"),q=u("Table"),S=u("Layer"),N=W("loading");return v(),F("div",ne,[C("div",se,[C("div",ue,[t(p,{inline:!0,model:e.params,class:"demo-form-inline"},{default:o(()=>[t(h,{label:"订单类型："},{default:o(()=>[t(m,{modelValue:e.query.qp_type_like,"onUpdate:modelValue":a[0]||(a[0]=l=>e.query.qp_type_like=l),placeholder:"请选择订单类型",clearable:""},{default:o(()=>[t(n,{label:"景点",value:1}),t(n,{label:"美食",value:2}),t(n,{label:"酒店",value:3})]),_:1},8,["modelValue"])]),_:1}),t(h,{label:"用户："},{default:o(()=>[t(m,{modelValue:e.query.qp_userId_like,"onUpdate:modelValue":a[1]||(a[1]=l=>e.query.qp_userId_like=l),placeholder:"请选择用户",clearable:""},{default:o(()=>[(v(!0),F(Y,null,H(e.userList,l=>(v(),D(n,{key:l.id,label:l.nickName,value:l.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),t(h,{label:"状态："},{default:o(()=>[t(m,{modelValue:e.query.qp_status_like,"onUpdate:modelValue":a[2]||(a[2]=l=>e.query.qp_status_like=l),placeholder:"请选择状态",clearable:""},{default:o(()=>[t(n,{label:"待发货",value:1}),t(n,{label:"待收货",value:2}),t(n,{label:"已收货",value:3}),t(n,{label:"退货中",value:4}),t(n,{label:"已退货",value:5})]),_:1},8,["modelValue"])]),_:1}),t(h,null,{default:o(()=>[t(s,{type:"primary",onClick:a[3]||(a[3]=l=>e.getTableData(!0))},{default:o(()=>[...a[6]||(a[6]=[f("查询",-1)])]),_:1})]),_:1})]),_:1},8,["model"])])]),C("div",ie,[C("div",de,[t(s,{type:"primary",icon:e.Plus,onClick:e.handleAdd},{default:o(()=>[f(_(e.$t("message.common.add")),1)]),_:1},8,["icon","onClick"]),t(V,{title:e.$t("message.common.delTip"),onConfirm:a[4]||(a[4]=l=>e.handleDel(e.chooseData))},{reference:o(()=>[t(s,{type:"danger",icon:e.Delete,disabled:e.chooseData.length===0},{default:o(()=>[f(_(e.$t("message.common.delBat")),1)]),_:1},8,["icon","disabled"])]),_:1},8,["title"])])]),C("div",me,[Q((v(),D(q,{ref:"table",page:e.page,"onUpdate:page":a[5]||(a[5]=l=>e.page=l),showIndex:!0,showSelection:!0,data:e.tableData,onGetTableData:e.getTableData,onSelectionChange:e.handleSelectionChange},{default:o(()=>[t(b,{prop:"type",label:"订单类型",align:"center"},{default:o(l=>[f(_(e.getTypeText(l.row.type)),1)]),_:1}),t(b,{prop:"userId",label:"用户",align:"center"},{default:o(l=>[f(_(e.getUserNickName(l.row.userId)),1)]),_:1}),t(b,{prop:"status",label:"状态",align:"center"},{default:o(l=>[f(_(e.getStatusText(l.row.status)),1)]),_:1}),t(b,{prop:"name",label:"名称",align:"center"}),t(b,{prop:"createTime",label:"创建时间",align:"center",formatter:e.handleTime},null,8,["formatter"]),t(b,{label:e.$t("message.common.handle"),align:"center",fixed:"right",width:"300"},{default:o(l=>[t(s,{onClick:k=>e.handleEdit(l.row)},{default:o(()=>[f(_(e.$t("message.common.update")),1)]),_:1},8,["onClick"]),l.row.status===1?(v(),D(s,{key:0,type:"success",onClick:k=>e.handleShipOrder(l.row)},{default:o(()=>[...a[7]||(a[7]=[f(" 发货 ",-1)])]),_:1},8,["onClick"])):L("",!0),l.row.status===4?(v(),D(s,{key:1,type:"warning",onClick:k=>e.handleReturnOrder(l.row)},{default:o(()=>[...a[8]||(a[8]=[f(" 退货 ",-1)])]),_:1},8,["onClick"])):L("",!0),t(V,{title:e.$t("message.common.delTip"),onConfirm:k=>e.handleDel([l.row])},{reference:o(()=>[t(s,{type:"danger"},{default:o(()=>[f(_(e.$t("message.common.del")),1)]),_:1})]),_:1},8,["title","onConfirm"])]),_:1},8,["label"])]),_:1},8,["page","data","onGetTableData","onSelectionChange"])),[[N,e.loading]]),e.layer.show?(v(),D(S,{key:0,layer:e.layer,onGetTableData:e.getTableData},null,8,["layer","onGetTableData"])):L("",!0)])])}const be=E(re,[["render",pe]]);export{be as default};

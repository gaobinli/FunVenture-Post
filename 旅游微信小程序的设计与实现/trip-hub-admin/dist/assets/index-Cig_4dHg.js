import{T as q}from"./index-F4zUvqIc.js";import{u as F,a as N,d as B,b as P}from"./role-bFoOqc15.js";import{g as E,a as U}from"./menu-BIDTTZs1.js";import{d as T,L as O,k as y,_ as V,y as C,o as _,w as l,b as o,r,c as k,x as G,F as M,i as w,N as z,E as A,a as v,e as D,t as $,J,K as j,M as I}from"./index-BrpxYkzO.js";import{s as K,a as R,b as H}from"./Search-hOF0ZlMh.js";const Q=T({components:{Layer:O},props:{layer:{type:Object,default:()=>({show:!1,title:"",showButton:!0})}},setup(e,a){const d=y(null),f=y(null);let m=y({id:"",code:"",name:"",menuCodes:[]}),g=y([]);const p={code:[{required:!0,message:"请输入角色编码",trigger:"blur"}],name:[{required:!0,message:"请输入角色姓名",trigger:"blur"}]};s();function s(){e.layer.row&&(m.value=JSON.parse(JSON.stringify(e.layer.row)),E(m.value.code).then(i=>{i.data.forEach(h=>{m.value.menuCodes.push(h.code)})})),U().then(i=>{g.value=i.data})}return{form:m,rules:p,layerDom:f,ruleForm:d,menuOptions:g}},methods:{submit(){this.ruleForm&&this.ruleForm.validate(e=>{if(e){let a=this.form;this.layer.row?this.updateForm(a):this.addForm(a)}else return!1})},addForm(e){N(e).then(a=>{this.$message({type:"success",message:"新增成功"}),this.$emit("getTableData",!0),this.layerDom&&this.layerDom.close()})},updateForm(e){F(e.id,e).then(a=>{this.$message({type:"success",message:"编辑成功"}),this.$emit("getTableData",!1),this.layerDom&&this.layerDom.close()})}}});function W(e,a,d,f,m,g){const p=r("el-input"),s=r("el-form-item"),i=r("el-option"),h=r("el-select"),b=r("el-form"),n=r("Layer",!0);return _(),C(n,{layer:e.layer,onConfirm:e.submit,ref:"layerDom"},{default:l(()=>[o(b,{model:e.form,rules:e.rules,ref:"ruleForm","label-width":"120px",style:{"margin-right":"30px"}},{default:l(()=>[o(s,{label:"角色编码：",prop:"code"},{default:l(()=>[o(p,{modelValue:e.form.code,"onUpdate:modelValue":a[0]||(a[0]=t=>e.form.code=t),disabled:e.form.id!=="",placeholder:"请输入名称"},null,8,["modelValue","disabled"])]),_:1}),o(s,{label:"角色名称：",prop:"name"},{default:l(()=>[o(p,{modelValue:e.form.name,"onUpdate:modelValue":a[1]||(a[1]=t=>e.form.name=t),placeholder:"请输入名称"},null,8,["modelValue"])]),_:1}),o(s,{label:"菜单："},{default:l(()=>[o(h,{modelValue:e.form.menuCodes,"onUpdate:modelValue":a[2]||(a[2]=t=>e.form.menuCodes=t),multiple:"",placeholder:"选择菜单，非必选"},{default:l(()=>[(_(!0),k(M,null,G(e.menuOptions,t=>(_(),C(i,{key:t.code,label:t.name,value:t.code},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["layer","onConfirm"])}const X=V(Q,[["render",W]]),Y=T({name:"crudTable",components:{Table:q,Layer:X},setup(){const e=w({}),a=w({show:!1,title:"新增",showButton:!0}),d=w({currentPage:1,pageSize:10,totalCount:0}),f=y(!0),m=y([]),g=y([]),p=n=>{g.value=n},s=n=>{f.value=!0,n&&(d.currentPage=1);let t={currentPage:d.currentPage,pageSize:d.pageSize,...e};B(t).then(c=>{m.value=c.data.list,d.totalCount=Number(c.data.totalCount)}).catch(c=>{m.value=[],d.currentPage=1,d.totalCount=0}).finally(()=>{f.value=!1})},i=n=>{let t={ids:n.map(c=>c.id).join(",")};P(t.ids).then(c=>{A({type:"success",message:"删除成功"}),s(m.value.length===1)})},h=()=>{a.title="新增数据",a.show=!0,delete a.row},b=n=>{a.title="编辑数据",a.row=n,a.show=!0};return s(!0),{Plus:H,Search:R,Delete:K,query:e,tableData:m,chooseData:g,loading:f,page:d,layer:a,handleSelectionChange:p,handleAdd:h,handleEdit:b,handleDel:i,getTableData:s,handleTime:z}}}),Z={class:"layout-container"},x={class:"layout-container-form flex space-between"},ee={class:"layout-container-form-search"},ae={class:"layout-container-form flex space-between"},oe={class:"layout-container-form-handle"},le={class:"layout-container-table"};function te(e,a,d,f,m,g){const p=r("el-input"),s=r("el-form-item"),i=r("el-button"),h=r("el-form"),b=r("el-popconfirm"),n=r("el-table-column"),t=r("Table"),c=r("Layer"),L=I("loading");return _(),k("div",Z,[v("div",x,[v("div",ee,[o(h,{inline:!0,model:e.params,class:"demo-form-inline"},{default:l(()=>[o(s,{label:"角色编码："},{default:l(()=>[o(p,{modelValue:e.query.qp_code_like,"onUpdate:modelValue":a[0]||(a[0]=u=>e.query.qp_code_like=u),placeholder:"请输入角色编码",clearable:""},null,8,["modelValue"])]),_:1}),o(s,{label:"角色名称："},{default:l(()=>[o(p,{modelValue:e.query.qp_name_like,"onUpdate:modelValue":a[1]||(a[1]=u=>e.query.qp_name_like=u),placeholder:"请输入角色名称",clearable:""},null,8,["modelValue"])]),_:1}),o(s,null,{default:l(()=>[o(i,{type:"primary",onClick:a[2]||(a[2]=u=>e.getTableData())},{default:l(()=>[...a[5]||(a[5]=[D("查询",-1)])]),_:1})]),_:1})]),_:1},8,["model"])])]),v("div",ae,[v("div",oe,[o(i,{type:"primary",icon:e.Plus,onClick:e.handleAdd},{default:l(()=>[D($(e.$t("message.common.add")),1)]),_:1},8,["icon","onClick"]),o(b,{title:e.$t("message.common.delTip"),onConfirm:a[3]||(a[3]=u=>e.handleDel(e.chooseData))},{reference:l(()=>[o(i,{type:"danger",icon:e.Delete,disabled:e.chooseData.length===0},{default:l(()=>[D($(e.$t("message.common.delBat")),1)]),_:1},8,["icon","disabled"])]),_:1},8,["title"])])]),v("div",le,[J((_(),C(t,{ref:"table",page:e.page,"onUpdate:page":a[4]||(a[4]=u=>e.page=u),showIndex:!0,showSelection:!0,data:e.tableData,onGetTableData:e.getTableData,onSelectionChange:e.handleSelectionChange},{default:l(()=>[o(n,{prop:"code",label:"编码",align:"center"}),o(n,{prop:"name",label:"角色名称",align:"center"}),o(n,{prop:"modifyTime",label:"修改时间",align:"center",formatter:e.handleTime},null,8,["formatter"]),o(n,{label:e.$t("message.common.handle"),align:"center",fixed:"right",width:"200"},{default:l(u=>[o(i,{onClick:S=>e.handleEdit(u.row)},{default:l(()=>[D($(e.$t("message.common.update")),1)]),_:1},8,["onClick"]),o(b,{title:e.$t("message.common.delTip"),onConfirm:S=>e.handleDel([u.row])},{reference:l(()=>[o(i,{type:"danger"},{default:l(()=>[D($(e.$t("message.common.del")),1)]),_:1})]),_:1},8,["title","onConfirm"])]),_:1},8,["label"])]),_:1},8,["page","data","onGetTableData","onSelectionChange"])),[[L,e.loading]]),e.layer.show?(_(),C(c,{key:0,layer:e.layer,onGetTableData:e.getTableData},null,8,["layer","onGetTableData"])):j("",!0)])])}const me=V(Y,[["render",te]]);export{me as default};

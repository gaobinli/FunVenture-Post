import{T as I}from"./index-F4zUvqIc.js";import{O as V,P as N,d as F,L as B,k as _,_ as U,y as T,o as b,w as o,b as l,r as n,c as S,a as v,e as $,x as O,F as E,i as k,N as G,E as z,t as C,J,K as j,M as A}from"./index-BrpxYkzO.js";import{s as q}from"./scenicSpot-CbD-Hf2l.js";import{u as L}from"./index-BlucuoM0.js";import{s as M,a as R,b as K}from"./Search-hOF0ZlMh.js";function H(e){return V({url:N("/icon",e),method:"get"})}function Q(e){return V({url:"/icon/"+e,method:"delete"})}function W(e){return V({url:"/icon",method:"post",data:e})}function X(e,t){return V({url:"/icon/"+e,method:"patch",data:t})}const Y="http://127.0.0.1:9000",Z=F({components:{Layer:B,UploadFilled:L},props:{layer:{type:Object,default:()=>({show:!1,title:"",showButton:!0})}},setup(e,t){const d=_(null),y=_(null);let c=_({id:"",name:"",url:"",sort:"",relationId:""});const h={id:[{required:!0,message:"请输入主键",trigger:"blur"}],name:[{required:!0,message:"请输入名称",trigger:"blur"}],url:[{required:!0,message:"请输入icon图标",trigger:"blur"}],sort:[{required:!0,message:"请输入排序",trigger:"blur"}],relationId:[{required:!0,message:"请输入关联跳转id",trigger:"blur"}]},f=_([]);let u=Y+"/upload";r();function r(){e.layer.row&&(c.value=JSON.parse(JSON.stringify(e.layer.row))),q().then(p=>{f.value=p.data})}return{form:c,rules:h,layerDom:y,ruleForm:d,uploadPath:u,UploadFilled:L,handleUploadSuccess:(p,m)=>{c.value.url=p.data},scenicSpotOptions:f}},methods:{submit(){this.ruleForm&&this.ruleForm.validate(e=>{if(e){let t=this.form;this.layer.row?this.updateForm(t):this.addForm(t)}else return!1})},addForm(e){W(e).then(t=>{this.$message({type:"success",message:"新增成功"}),this.$emit("getTableData",!0),this.layerDom&&this.layerDom.close()})},updateForm(e){X(e.id,e).then(t=>{this.$message({type:"success",message:"编辑成功"}),this.$emit("getTableData",!1),this.layerDom&&this.layerDom.close()})}}}),x=["src"],ee={key:1};function te(e,t,d,y,c,h){const f=n("el-input"),u=n("el-form-item"),r=n("upload-filled"),w=n("el-icon"),p=n("el-upload"),m=n("el-input-number"),D=n("el-option"),s=n("el-select"),g=n("el-form"),i=n("Layer",!0);return b(),T(i,{layer:e.layer,onConfirm:e.submit,ref:"layerDom"},{default:o(()=>[l(g,{model:e.form,rules:e.rules,ref:"ruleForm","label-width":"120px",style:{"margin-right":"30px"}},{default:o(()=>[l(u,{label:"名称：",prop:"name"},{default:o(()=>[l(f,{modelValue:e.form.name,"onUpdate:modelValue":t[0]||(t[0]=a=>e.form.name=a),placeholder:"请输入名称"},null,8,["modelValue"])]),_:1}),l(u,{label:"icon图标：",prop:"url"},{default:o(()=>[l(p,{class:"upload-demo",drag:"",action:e.uploadPath,multiple:"false","on-success":e.handleUploadSuccess,"show-file-list":!1},{default:o(()=>[e.form.url?(b(),S("img",{key:0,src:e.form.url,class:"avatar",style:{widht:"148px",height:"148px"}},null,8,x)):(b(),S("span",ee,[l(w,{class:"el-icon--upload"},{default:o(()=>[l(r)]),_:1}),t[3]||(t[3]=v("div",{class:"el-upload__text"},[$(" 拖动图片或 "),v("em",null,"点击上传")],-1))]))]),_:1},8,["action","on-success"])]),_:1}),l(u,{label:"排序：",prop:"sort"},{default:o(()=>[l(m,{modelValue:e.form.sort,"onUpdate:modelValue":t[1]||(t[1]=a=>e.form.sort=a),min:1,max:99999,onChange:e.handleChange},null,8,["modelValue","onChange"])]),_:1}),l(u,{label:"关联跳转id：",prop:"relationId"},{default:o(()=>[l(s,{modelValue:e.form.relationId,"onUpdate:modelValue":t[2]||(t[2]=a=>e.form.relationId=a),filterable:"",clearable:"",placeholder:"请选择景点"},{default:o(()=>[(b(!0),S(E,null,O(e.scenicSpotOptions,a=>(b(),T(D,{key:a.id,label:a.name,value:a.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["layer","onConfirm"])}const le=U(Z,[["render",te]]),oe=F({name:"crudTable",components:{Table:I,Layer:le},setup(){const e=k({}),t=k({show:!1,title:"新增",showButton:!0}),d=k({currentPage:1,pageSize:10,totalCount:0}),y=_([]),c=_(!0),h=_([]),f=_([]),u=s=>{f.value=s},r=s=>{c.value=!0,s&&(d.currentPage=1,q().then(i=>{y.value=i.data}));let g={currentPage:d.currentPage,pageSize:d.pageSize,...e};H(g).then(i=>{h.value=i.data.list,d.totalCount=Number(i.data.totalCount)}).catch(i=>{h.value=[],d.currentPage=1,d.totalCount=0}).finally(()=>{c.value=!1})},w=s=>{let g={ids:s.map(i=>i.id).join(",")};Q(g.ids).then(i=>{z({type:"success",message:"删除成功"}),r(h.value.length===1)})},p=()=>{t.title="新增数据",t.show=!0,delete t.row},m=s=>{t.title="编辑数据",t.row=s,t.show=!0};return r(!0),{Plus:K,Search:R,Delete:M,query:e,tableData:h,chooseData:f,loading:c,page:d,layer:t,handleSelectionChange:u,handleAdd:p,handleEdit:m,handleDel:w,getTableData:r,handleTime:G,handleScenicSpot:s=>y.value.find(g=>g.id===s.relationId).name,scenicSpotOptions:y}}}),ae={class:"layout-container"},ne={class:"layout-container-form flex space-between"},re={class:"layout-container-form-search"},se={class:"layout-container-form flex space-between"},ie={class:"layout-container-form-handle"},de={class:"layout-container-table"};function ue(e,t,d,y,c,h){const f=n("el-input"),u=n("el-form-item"),r=n("el-button"),w=n("el-form"),p=n("el-popconfirm"),m=n("el-table-column"),D=n("el-image"),s=n("Table"),g=n("Layer"),i=A("loading");return b(),S("div",ae,[v("div",ne,[v("div",re,[l(w,{inline:!0,model:e.params,class:"demo-form-inline"},{default:o(()=>[l(u,{label:"名称："},{default:o(()=>[l(f,{modelValue:e.query.qp_name_like,"onUpdate:modelValue":t[0]||(t[0]=a=>e.query.qp_name_like=a),placeholder:"请输入名称",clearable:""},null,8,["modelValue"])]),_:1}),l(u,null,{default:o(()=>[l(r,{type:"primary",onClick:t[1]||(t[1]=a=>e.getTableData())},{default:o(()=>[...t[4]||(t[4]=[$("查询",-1)])]),_:1})]),_:1})]),_:1},8,["model"])])]),v("div",se,[v("div",ie,[l(r,{type:"primary",icon:e.Plus,onClick:e.handleAdd},{default:o(()=>[$(C(e.$t("message.common.add")),1)]),_:1},8,["icon","onClick"]),l(p,{title:e.$t("message.common.delTip"),onConfirm:t[2]||(t[2]=a=>e.handleDel(e.chooseData))},{reference:o(()=>[l(r,{type:"danger",icon:e.Delete,disabled:e.chooseData.length===0},{default:o(()=>[$(C(e.$t("message.common.delBat")),1)]),_:1},8,["icon","disabled"])]),_:1},8,["title"])])]),v("div",de,[J((b(),T(s,{ref:"table",page:e.page,"onUpdate:page":t[3]||(t[3]=a=>e.page=a),showIndex:!0,showSelection:!0,data:e.tableData,onGetTableData:e.getTableData,onSelectionChange:e.handleSelectionChange},{default:o(()=>[l(m,{prop:"name",label:"名称",align:"center"}),l(m,{prop:"url",label:"icon图标",align:"center"},{default:o(a=>[l(D,{style:{width:"100px",height:"100px"},src:a.row.url,"preview-src-list":[a.row.url],"initial-index":0,fit:"url","append-to-body":!0},null,8,["src","preview-src-list"])]),_:1}),l(m,{prop:"sort",label:"排序",align:"center"}),l(m,{prop:"relationId",label:"关联景点",align:"center",formatter:e.handleScenicSpot},null,8,["formatter"]),l(m,{prop:"createTime",label:"创建时间",align:"center",formatter:e.handleTime},null,8,["formatter"]),l(m,{label:e.$t("message.common.handle"),align:"center",fixed:"right",width:"200"},{default:o(a=>[l(r,{onClick:P=>e.handleEdit(a.row)},{default:o(()=>[$(C(e.$t("message.common.update")),1)]),_:1},8,["onClick"]),l(p,{title:e.$t("message.common.delTip"),onConfirm:P=>e.handleDel([a.row])},{reference:o(()=>[l(r,{type:"danger"},{default:o(()=>[$(C(e.$t("message.common.del")),1)]),_:1})]),_:1},8,["title","onConfirm"])]),_:1},8,["label"])]),_:1},8,["page","data","onGetTableData","onSelectionChange"])),[[i,e.loading]]),e.layer.show?(b(),T(g,{key:0,layer:e.layer,onGetTableData:e.getTableData},null,8,["layer","onGetTableData"])):j("",!0)])])}const he=U(oe,[["render",ue]]);export{he as default};
